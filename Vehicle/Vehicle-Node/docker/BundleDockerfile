FROM nslrpi/spindle-node-base:latest

ENV workdir /opt

ENV kafkadir $workdir/kafka
ENV vehicledir $workdir/vehicle

ENV kafkadirlocal kafka_2.11-0.10.2.1

RUN echo "deb https://dl.bintray.com/sbt/debian /" | tee -a /etc/apt/sources.list.d/sbt.list
RUN apt-key adv --keyserver hkp://keyserver.ubuntu.com:80 --recv 2EE0EA64E40A89B84B2DF73499E82A75642AC823
#RUN apt-get install -y apt-transport-https
RUN apt-get update
RUN apt-get install -y openjdk-8-jre-headless openjdk-8-jdk-headless
RUN apt-get install -y sbt
RUN apt-get install -y supervisor && mkdir -p /var/log/supervisor

COPY supervisord.conf /etc/supervisor/conf.d/supervisord.conf

EXPOSE 9001

RUN mkdir -p $kafkadir

COPY ./$kafkadirlocal $kafkadir/

COPY entrypoint.sh $workdir/

RUN chmod +x $workdir/entrypoint.sh

WORKDIR $workdir

CMD ["./entrypoint.sh"]
